<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot with Toggle and Quotation Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        /* Chatbot Icons */
        .chatbot-icon {
            position: fixed;
            bottom: 20px;
            right: 20px;
            /* background: #007bff; */
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            /* box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); */
            box-shadow:  28px 28px 56px #927f7f,
             -28px -28px 56px #c6abab;
        }

        /* Chatbot Container (Hidden by default) */
        .chatbot-container {
            position: fixed;
            bottom: 10px;
            right: 20px;
            width: 350px;
            background: linear-gradient(to bottom, #F0F8FF, #E6E6FA);


            
            
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: none;
            flex-direction: column;

            position: fixed;
    bottom: 10px;
    right: 20px;
    width: 350px;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    display: none;  /* Initially hidden */
    flex-direction: column;
    
    /* Add transition for smooth effect */
    opacity: 0;
    transform: scale(0.8);
    transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }

        /* Chat Header */
        .chat-header {
            background: #007bff;
            color: white;
            padding: 10px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-btn {
            cursor: pointer;
            font-size: 20px;
            padding: 0 3px;
        }

        /* Chat Messages */
        .chat-messages {
            /* border: 2px solid red; */
    height: 300px;
    overflow-y: auto;
    padding: 10px;
    /* background: #; */
    display: flex;
    flex-direction: column;
    justify-content: flex-start; /* Ensure messages stack properly */
    scroll-behavior: smooth; /* Smooth scrolling */
}
.chat-messages::-webkit-scrollbar{
    display: none;
}


        .message {
            padding: 8px;
            border-radius: 5px;
            margin: 5px 0;
            max-width: 80%;
        }

        .user-message {
            background: #007bff;
            color: white;
            text-align: right;
            margin-left: auto;
        }

        .bot-message {
            background: #f1f1f1;
            color: black;
        }

        /* Chat Input */
        .chat-input {
            display: flex;
            /* height: 50px; */
            padding: 10px;
            border-top: 1px solid #d3c7c7;
            background-color: #E6E6FA;
        }

        .chat-input input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            outline: none;
            background-color: #E6E6FA;

        }

        .chat-input button {
            /* background: #007bff; */
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 5px;
            background-color: #E6E6FA ;
            /* box-shadow: 2px 2px 2px red; */
            /* border-radius: 50px; */
/* background: #e0e0e0; */
box-shadow:  20px 20px 60px #bebebe,
             -20px -20px 60px #ffffff;
            
        }

        /* .chat-input button:hover { */
            /* background: #0056b3; */
        /* } */

        /* Quotation Form */
        .form-message {
    background: #f8f9fa;
    padding: 10px;
    border-radius: 5px;
    margin: 5px 0;
    max-width: 95%;  /* ✅ Prevents overflowing */
    width: auto;  /* ✅ Adjusts width dynamically */
    box-sizing: border-box;  /* ✅ Ensures padding is included in width */
    display: flex;
    flex-direction: column;
    align-items: center;  /* ✅ Centers content */
}

.form-message input,
.form-message select,
.form-message button {
    width: 90%;  /* ✅ Prevents input fields from overflowing */
    max-width: 300px;  /* ✅ Keeps inputs within form */
    padding: 8px;
    margin: 5px 0;
    border-radius: 5px;
    border: 1px solid #ddd;
    box-sizing: border-box;  /* ✅ Ensures width includes padding */
}

/* ✅ Fix close button position */
.form-message .close_form {
    position: absolute;
    top: 5px;
    right: 5px;
    width: 35px;
    height: 35px;
    font-size: 16px;
    padding: 5px;
    border-radius: 50%;
    background: red;
    color: white;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}

.form-message .close_form:hover {
    background: darkred;
}
        .loader {
  width: 40px;
  aspect-ratio: 2;
  --_g: no-repeat radial-gradient(circle closest-side,#000 90%,#0000);
  background: 
    var(--_g) 0%   50%,
    var(--_g) 50%  50%,
    var(--_g) 100% 50%;
  background-size: calc(100%/3) 50%;
  animation: l3 1s infinite linear;
}
@keyframes l3 {
    20%{background-position:0%   0%, 50%  50%,100%  50%}
    40%{background-position:0% 100%, 50%   0%,100%  50%}
    60%{background-position:0%  50%, 50% 100%,100%   0%}
    80%{background-position:0%  50%, 50%  50%,100% 100%}
}

.carousel-container {
        /* border: 2PX SOLID blue  ; */
           /* padding: 10px; */
            position: relative;
          width: 100%;
          padding-top: 10px;
            overflow: hidden;
            border-radius: 5px;
            /* box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); */
            /* background: #fff; */
            padding-bottom: 10px;
        }

        .carousel {
            padding:"20px";
            display: flex;
            transition: transform 0.5s ease-in-out;
            width: 100%;
        }

        .carousel-item {
            min-width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            /* background: #f1f1f1; */
        }

        .carousel-item img {
          
            width: 90%;
            height: 150px;
            object-fit: cover; /* Ensures image fills the box properly */
            border-radius: 10px;
        }


        .maincontainer{
display: flex;
flex-direction: column;

        }
        /* Navigation Buttons */
        .carousel-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            /* padding: 10px 15px; */
            cursor: pointer;
            border-radius: 50%;
            font-size: 18px;
            transition: background 0.3s ease-in-out;
        }

        .carousel-btn:hover {
            background: rgba(0, 0, 0, 0.8);
        }

        .prev {
            left: 10px;
        }

        .next {
            right: 10px;
        }
.quries{
margin-top: 10px;
/* display: flex; */


}
        /* Responsive for smaller screens */
        @media (max-width: 480px) {
            .carousel-container {
                max-width: 320px;
            }
            .carousel-item {
                height: 150px;
            }
            .carousel-btn {
                font-size: 16px;
                padding: 8px 12px;
            }
        }


        .quation {
    display: flex;
    justify-content: space-around;
    align-items: start;
    flex-wrap: wrap;
    gap: 10px;
    background: transparent;
    padding: 20px;
    /* display: grid;
    grid-template-columns: 7fr 5fr;
    gap: 10px;
    padding: 20px;
    border: 2px solid red; */
}

.custom-btn {
    padding: 10px 15px;
    font-size: 14px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    border-radius: 20px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    white-space: nowrap;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

.btn-1 {
    background: #007bff;
    color: white;     
  position: relative;
  width: 120px;
  height: 55px;
  border-radius: 45px;
  border: none;
  background-color: rgb(151, 95, 255);
  color: white;
  box-shadow: 0px 10px 10px rgb(210, 187, 253) inset,
  0px 5px 10px rgba(5, 5, 5, 0.212),
  0px -10px 10px rgb(124, 54, 255) inset;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.Btn::before {
  width: 70%;
  height: 2px;
  position: absolute;
  background-color: rgba(250, 250, 250, 0.678);
  content: "";
  filter: blur(1px);
  top: 7px;
  border-radius: 50%;
}

.Btn::after {
  width: 70%;
  height: 2px;
  position: absolute;
  background-color: rgba(250, 250, 250, 0.137);
  content: "";
  filter: blur(1px);
  bottom: 7px;
  border-radius: 50%;
}

.Btn:hover {
  animation: jello-horizontal 0.9s both;
}

@keyframes jello-horizontal {
  0% {
    transform: scale3d(1, 1, 1);
  }

  30% {
    transform: scale3d(1.25, 0.75, 1);
  }

  40% {
    transform: scale3d(0.75, 1.25, 1);
  }

  50% {
    transform: scale3d(1.15, 0.85, 1);
  }

  65% {
    transform: scale3d(0.95, 1.05, 1);
  }

  75% {
    transform: scale3d(1.05, 0.95, 1);
  }

  100% {
    transform: scale3d(1, 1, 1);
  }
}



.btn-1:hover {
    background: #0056b3;
}

.btn-icon {
    width: 18px;
    height: 18px;
}
/* From Uiverse.io by zjssun */ 
.buttonanimated {
  line-height: 1;
  text-decoration: none;
  display: inline-flex;
  border: none;
  width: 140px;
  cursor: pointer;
  align-items: center;
  gap: 0.75rem;
  background-color: var(--clr);
  color: #fff;
  border-radius: 10rem;
  font-weight: 600;
  padding: 0.50rem 1.5rem;
  padding-left: 20px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  transition: background-color 0.3s;
}

.button__icon-wrapper {
  flex-shrink: 0;
  width: 25px;
  height: 25px;
  position: relative;
  color: var(--clr);
  background-color: #fff;
  border-radius: 50%;
  display: grid;
  place-items: center;
  overflow: hidden;
}

.buttonanimated:hover {
  background-color: #000;
}

.buttonanimated:hover .button__icon-wrapper {
  color: #000;
}

.button__icon-svg--copy {
  position: absolute;
  transform: translate(-150%, 150%);
}

.buttonanimated:hover .button__icon-svg:first-child {
  transition: transform 0.3s ease-in-out;
  transform: translate(150%, -150%);
}

.buttonanimated:hover .button__icon-svg--copy {
  transition: transform 0.3s ease-in-out 0.1s;
  transform: translate(0);
}




#quotation-form{
    position: relative;
}

@media (max-height: 800px) {
    .chatbot-container {
            position: fixed;
            bottom: 10px;
            right: 20px;
            /* width: 0px; */
            height: 96vh;
            background: linear-gradient(to bottom, #F0F8FF, #E6E6FA);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: none;
            flex-direction: column;
            /* border: 2px solid red; */
            position: fixed;
    bottom: 10px;
    right: 20px;
    width: 350px;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    display: none;  /* Initially hidden */
    flex-direction: column;
    
    /* Add transition for smooth effect */
    opacity: 0;
    transform: scale(0.8);
    transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }

        
}


/* ✅ Mobile-Friendly Adjustments */
@media (max-width: 480px) {
    /* Chatbot container size adjustment */
    .chatbot-container {
    width: 90%;   /* Make chatbot container take most of the screen */
    right: 5%;    /* Center the chatbot */
    bottom: 10px; /* Adjust position */
    border-radius: 8px;
    height: 80vh; /* ✅ Set height to 90% of the viewport height */
    /* border: 2px solid red; */
     /* ✅ Correct border syntax */
}




.button__icon-wrapper {
  flex-shrink: 0;
  width: 15px;
  height: 15px;
  position: relative;
  color: var(--clr);
  background-color: #fff;
  border-radius: 50%;
  display: grid;
  place-items: center;
  overflow: hidden;
}


.buttonanimated {
  line-height: 1;
  text-decoration: none;
  display: inline-flex;
  border: none;
  width: 120px;
  cursor: pointer;
  align-items: center;
  /* gap: 0.75rem; */
  background-color: var(--clr);
  color: #ffffff;
  border-radius: 5rem;
  /* font-weight: 600; */
  /* padding: 0.50rem 1.5rem;
  padding-left: 20px; */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  transition: background-color 0.3s;
}


    /* Reduce chat messages height */
    .chat-messages {
        height: 250px; /* Smaller height for mobile screens */
        border-radius: 2px;
/* background: #e0e0e0; */
box-shadow:  20px 20px 60px #bebebe,
             -20px -20px 60px #ffffff;
             padding-left: 20px;
             padding-right: 20px;
             
    }

    /* Adjust header size */
    .chat-header {
        font-size: 16px;
        padding: 8px;
    }

    /* Chat input adjustments */
    .chat-input {
        flex-direction: row;
        padding: 8px;
    }

    .chat-input input {
        padding: 6px;
        font-size: 14px;
        border-radius: 4px;
    }

    .chat-input button {
        padding: 6px 10px;
        font-size: 14px;
        border-radius: 4px;
    }

    /* ✅ Make carousel images fit better on small screens */
    .carousel-container {
        max-width: 100%;
        /* padding-left: "20px"; */
        /* align-items: center; */
        /* border: 2px solid red; */
        height: 140px;
        overflow: hidden;
    }

    .carousel-item img {
        width: 75%;
        height: 120px; /* Adjust height */
        border-radius: 8px;
        /* border: 2px solid red; */
        margin-top: -30px;
    }

    /* Reduce carousel button size */
    .carousel-btn {
        font-size: 5px;
        /* padding: 5px 10px; */
        /* border: 2px solid red; */

    }

    /* ✅ Adjust button layout for mobile */
    .quation {
        /* display: grid;
    grid-template-columns: 6fr 6fr;
    justify-content: space-between;
    margin-left: 12px; */
    /* gap: 10px; */
    /* padding: 20px; */
    /* border: 2px solid red; */
    /* margin-top: -70px;
    align-content: center; */
    margin-top: -20px;
    display: flex;
    justify-content: space-around;
    align-items: start;
    flex-wrap: wrap;
    
    /* gap: 10px; */
    background: transparent;
    padding-left: 35px;
    padding-right: 35PX;
    padding-top: 0px;
    padding-bottom: -10px;

    }

    /* Make buttons smaller for mobile */
    .custom-btn {
        font-size: 5px;
        padding: 8px;
    }
    

    .btn-1 {
        width: 100px;
        height: 45px;
        font-size: 12px;
        border: 2px solid red;

    }

    /* Adjust chatbot icon size */
    .chatbot-icon {
        width: 50px;
        height: 50px;
        font-size: 20px;
    }

    /* Ensure chatbot input fields fit well */
    .form-message {
        width: 95%;  /* ✅ Adjust form width */
        max-width: 400px;
        /* border: 2px solid red; */
        margin-left: 10px;
    }

    .form-message input,
    .form-message select,
    .form-message button {
        width: 85%;  /* ✅ Adjust input widths */
    }
    .close_form{
        margin-top: 500px;
        border: 2px solid red;
    }

    .contactheader{
        margin: 5px;
    }
}



/* Toast Notification Styles */
.toast {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 12px 20px;
    border-radius: 5px;
    font-size: 14px;
    font-weight: bold;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
}

/* Show Toast */
.toast.show {
    opacity: 1;
    visibility: visible;
}

.formsubmitbutton{
    background-color: white;
    color: black;
    cursor: pointer;
}
.formsubmitbutton:hover{
    background-color: rgb(0, 4, 255);
    color: white;
}

    </style>

    
</head>
<body  >

    <!-- Chatbot Icon -->
    <div class="chatbot-icon" id="chatbot-icon" onclick="toggleChatbot()">
        <img src="https://cdn-icons-png.freepik.com/256/11765/11765239.png?uid=P7856354&ga=GA1.1.300942411.1741840633&semt=ais_hybrid" style="width: 45px; height: 45px;"  />
    </div>

    <div id="toast" class="toast"></div>

    
    <div class="chatbot-container" id="chatbot">
        <div class="chat-header">
            <img src="https://brihaspathi.com/assets-bt/img/logo.png" alt="" height="50px" width="150px">
            <span class="close-btn" onclick="toggleChatbot()">
                <img src="https://cdn-icons-png.freepik.com/256/11607/11607141.png?uid=P7856354&ga=GA1.1.300942411.1741840633&semt=ais_hybrid" style="width: 40px; height: 40px;" />
            </span> 
        </div>
    
        <!-- Move carousel container OUTSIDE chat-messages -->
        <div class="carousel-container">
            <div class="carousel">
                <!-- <div class="carousel-item">
                    <video controls autoplay loop muted width="100%" height="auto">
                        <source src="http://127.0.0.1:5500/website/assets-bt/drone.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div> -->
                <div class="carousel-item"><img src="https://brihaspathi.com/btlvisitor/btlvisitor/chatbot-2_20250312T065056122Z.jpeg"></div>
                <div class="carousel-item"><img src="https://brihaspathi.com/btlvisitor/btlvisitor/chatbot-3_20250312T065108078Z.jpeg"></div>
                <div class="carousel-item"><img src="https://brihaspathi.com/btlvisitor/btlvisitor/chatbot-4_20250312T065117987Z.jpeg"></div>
                <div class="carousel-item"><img src="https://brihaspathi.com/btlvisitor/btlvisitor/chatbot-5_20250312T065129417Z.jpeg"></div>
                <div class="carousel-item"><img src="https://brihaspathi.com/btlvisitor/btlvisitor/chatbot-6_20250312T065145092Z.jpeg"></div>
                <div class="carousel-item"><img src="https://brihaspathi.com/btlvisitor/btlvisitor/chatbot-7_20250312T065154978Z.jpeg"></div>
            </div> 
        </div>

            <div class="quries" >
                <div class="quation">
                    <!-- Products Button -->
                   <!-- From Uiverse.io by Creatlydev --> 
            <button href="#" class="buttonanimated" style="--clr: #7808d0" onclick="handleButtonClick('About us')" >
    <span class="button__icon-wrapper">
      <svg
        viewBox="0 0 14 15"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        class="button__icon-svg"
        width="10"
      >
        <path
          d="M13.376 11.552l-.264-10.44-10.44-.24.024 2.28 6.96-.048L.2 12.56l1.488 1.488 9.432-9.432-.048 6.912 2.304.024z"
          fill="currentColor"
        ></path>
      </svg>
  
      <svg
        viewBox="0 0 14 15"
        fill="none"
        width="10"
        xmlns="http://www.w3.org/2000/svg"
        class="button__icon-svg button__icon-svg--copy"
      >
        <path
          d="M13.376 11.552l-.264-10.44-10.44-.24.024 2.28 6.96-.048L.2 12.56l1.488 1.488 9.432-9.432-.048 6.912 2.304.024z"
          fill="currentColor"
        ></path>
      </svg>
    </span>
    About us
            </button>
  
            
                    <!-- Projects Button -->
                    <button href="#" class="buttonanimated" style="--clr: #7808d0" onclick="handleButtonClick('Products')" >
                        <span class="button__icon-wrapper">
                          <svg
                            viewBox="0 0 14 15"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                            class="button__icon-svg"
                            width="10"
                          >
                            <path
                              d="M13.376 11.552l-.264-10.44-10.44-.24.024 2.28 6.96-.048L.2 12.56l1.488 1.488 9.432-9.432-.048 6.912 2.304.024z"
                              fill="currentColor"
                            ></path>
                          </svg>
                      
                          <svg
                            viewBox="0 0 14 15"
                            fill="none"
                            width="10"
                            xmlns="http://www.w3.org/2000/svg"
                            class="button__icon-svg button__icon-svg--copy"
                          >
                            <path
                              d="M13.376 11.552l-.264-10.44-10.44-.24.024 2.28 6.96-.048L.2 12.56l1.488 1.488 9.432-9.432-.048 6.912 2.304.024z"
                              fill="currentColor"
                            ></path>
                          </svg>
                        </span>
                        Products
                                </button>
            
                    <!-- Contact Us Button (Opens Quotation Form) -->
                    <button href="#" class="buttonanimated" style="--clr: #7808d0" onclick="handleButtonClick('Careers')"  >
                        <span class="button__icon-wrapper">
                          <svg
                            viewBox="0 0 14 15"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                            class="button__icon-svg"
                            width="10"
                          >
                            <path
                              d="M13.376 11.552l-.264-10.44-10.44-.24.024 2.28 6.96-.048L.2 12.56l1.488 1.488 9.432-9.432-.048 6.912 2.304.024z"
                              fill="currentColor"
                            ></path>
                          </svg>
                      
                          <svg
                            viewBox="0 0 14 15"
                            fill="none"
                            width="10"
                            xmlns="http://www.w3.org/2000/svg"
                            class="button__icon-svg button__icon-svg--copy"
                          >
                            <path
                              d="M13.376 11.552l-.264-10.44-10.44-.24.024 2.28 6.96-.048L.2 12.56l1.488 1.488 9.432-9.432-.048 6.912 2.304.024z"
                              fill="currentColor"
                            ></path>
                          </svg>
                        </span>
                        Careers                            
                </button>
                                <button href="#" class="buttonanimated" style="--clr: #7808d0" onclick="showQuotationForm()"  >
                                    <span class="button__icon-wrapper">
                                      <svg
                                        viewBox="0 0 14 15"
                                        fill="none"
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="button__icon-svg"
                                        width="10"
                                      >
                                        <path
                                          d="M13.376 11.552l-.264-10.44-10.44-.24.024 2.28 6.96-.048L.2 12.56l1.488 1.488 9.432-9.432-.048 6.912 2.304.024z"
                                          fill="currentColor"
                                        ></path>
                                      </svg>
                                  
                                      <svg
                                        viewBox="0 0 14 15"
                                        fill="none"
                                        width="10"
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="button__icon-svg button__icon-svg--copy"
                                      >
                                        <path
                                          d="M13.376 11.552l-.264-10.44-10.44-.24.024 2.28 6.96-.048L.2 12.56l1.488 1.488 9.432-9.432-.048 6.912 2.304.024z"
                                          fill="currentColor"
                                        ></path>
                                      </svg>
                                    </span>
                                    Contact us
                                            </button>
                </div>
            </div>
            
      

    
        <div class="chat-messages" id="chat-messages"></div>
        
        <div class="chat-input">
            <input type="text" id="user-input" placeholder="Ask me anything..." onkeypress="handleKeyPress(event)">
            <button id="send-button" onclick="sendMessage()">
                <img src="https://cdn-icons-png.freepik.com/256/9131/9131510.png?uid=P7856354&ga=GA1.1.300942411.1741840633&semt=ais_hybrid" style="width: 30px; height: 30px;" />
            </button>
        </div>
        
    </div>
    
    <script>

let index = 0;

let isFormOpen = false; // Track if the quotation form is open
let issendbutton =  false

const totalSlides = document.querySelectorAll(".carousel-item").length;

function moveCarousel() {
    const carousel = document.querySelector(".carousel");
    index = (index + 1) % totalSlides; // Loops back to the first slide
    carousel.style.transform = `translateX(-${index * 100}%)`;
}

// Change slide every **4 seconds (4000ms)**
setInterval(moveCarousel, 4000);

        function toggleChatbot() {




            const chatbot = document.getElementById("chatbot");
    const chatbotIcon = document.getElementById("chatbot-icon");

    if (chatbot.style.display === "none" || chatbot.style.display === "") {
        chatbot.style.display = "flex";
        chatbot.style.opacity = "0";  // Start fully transparent
        chatbot.style.transform = "scale(0.8)";  // Start small
        chatbotIcon.style.display = "none";  // Hide the icon

        // **Apply smooth transition**
        setTimeout(() => {
            chatbot.style.opacity = "1";
            chatbot.style.transform = "scale(1)";
        }, 50);  // Delay to allow transition

    } else {
        chatbot.style.opacity = "0";
        chatbot.style.transform = "scale(0.8)";

        // Wait for transition to finish before hiding
        setTimeout(() => {
            chatbot.style.display = "none";
            chatbotIcon.style.display = "flex";  // Show chatbot icon again
        }, 300);  // Matches the transition duration
    }




            
        
        }
//         function handleKeyPress(event) {
//     // ✅ Check if the form is currently open
//    if(
//     event.key==="Enter"
//    ){
//     if (isFormOpen) {
//         alert("⚠️ Please complete or close the quotation form before sending a message.");
//         return;
//     }
//    }

//     if (event.key === "Enter") {
//         sendMessage();
//     }
// }

function handleKeyPress(event) {
    if (event.key === "Enter") {
        if (isFormOpen) {
            showToast("⚠️ Please complete or close the quotation form before sending a message.");
            return; // ✅ Prevent message from being sent
        }
        sendMessage();
    }
}



// Function to send messages (includes history storage)
async function sendMessage() {
    if (isFormOpen) {
        showToast("⚠️ Please complete or close the quotation form before sending a message.");
        return;
    }

    if (issendbutton) {
        // alert("⚠️ Please wait for the bot's response before sending another message.");
        return;
    }

    issendbutton = true;  // ✅ Prevent multiple requests

    const inputField = document.getElementById("user-input");
    const messageText = inputField.value.trim();
    if (messageText === "") {
        showToast("⚠️ Please enter a message before sending.");
        issendbutton = false;  // ✅ Allow resending if no message is entered
        return;
    }

    const messagesDiv = document.getElementById("chat-messages");

    // ✅ Store and Append User Message
    storeMessage({ type: "user", text: messageText });
    const userMsg = document.createElement("div");
    userMsg.className = "message user-message";
    userMsg.innerHTML = `${messageText}`;
    messagesDiv.appendChild(userMsg);
    inputField.value = "";

    // ✅ Scroll **only** to the user question
    userMsg.scrollIntoView({ behavior: "smooth", block: "start" });

    // ✅ Check for quotation-related keywords
    const lowerCaseMessage = messageText.toLowerCase();
    if (lowerCaseMessage.includes("quote") || lowerCaseMessage.includes("quotation")) {
        console.log("✅ Keyword detected! Opening Quotation Form...");
        showQuotationForm();
        issendbutton = false; // ✅ Reset send button
        return;
    }

    // ✅ Create loader element
    const loader = document.createElement("div");
    loader.className = "loader";
    messagesDiv.appendChild(loader);
    loader.scrollIntoView({ behavior: "smooth", block: "start" });

    try {
        const response = await fetch("http://192.168.1.155:8000/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: messageText })
        });

        const data = await response.json();
        loader.remove();

        // ✅ Store and Append Bot Response
        storeMessage({ type: "bot", text: data.response || "I'm here to help!" });
        const botMsg = document.createElement("div");
        botMsg.className = "message bot-message";
        botMsg.innerHTML = `${data.response || "I'm here to help!"}`;
        messagesDiv.appendChild(botMsg);

        // ✅ Scroll to user question position
        userMsg.scrollIntoView({ behavior: "smooth", block: "start" });

    } catch (error) {
        console.error("❌ Error fetching response:", error);
        loader.remove();
    } finally {
        issendbutton = false;  // ✅ Always reset, even if an error occurs
    }
}




function showQuotationForm() {
    if (document.getElementById("quotation-form")) {
        return;
    }

    const messagesDiv = document.getElementById("chat-messages");

    const formContainer = document.createElement("div");
    formContainer.className = "form-message";
    formContainer.id = "quotation-form";

    formContainer.innerHTML = `
        <button class="close_form" onclick="closeQuotationForm(event)" >✖</button>
        <h3 class="contactheader" >Contact us</h3>
        <input type="text" id="fullName" placeholder="Your Name" required>
        <input type="email" id="email" placeholder="Email Address" required>
        <input type="tel" id="phone" placeholder="Mobile Number" required>
        <select id="interest" required>
            <option value="">Loading...</option>
        </select>
        <button class="formsubmitbutton" onclick="submitQuotation()">Submit</button>
    `;

    messagesDiv.appendChild(formContainer);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;

    // ✅ Set flag to indicate the form is open
    isFormOpen = true;
   

    fetchLoBData();
}


async function fetchLoBData() {
    const LOB_URL = 'https://app.bizgaze.com/apis/v4/bizgaze/integrations/getlobs/getlobs';

    try {
        const response = await fetch(LOB_URL, {
            headers: { "Authorization": 'stat 27f4d43e52654efe8cd3257c36865ac7' }
        });

        if (!response.ok) {
            throw new Error('Failed to fetch LoB data');
        }

        const data = await response.json();
        const lobArray = JSON.parse(data.result); // Convert string to JSON array

        const selectElement = document.getElementById("interest");

        // Clear existing options and add new ones
        selectElement.innerHTML = `<option value="">Select an Interest</option>`;
        lobArray.forEach(lob => {
            const option = document.createElement("option");
            option.value = lob.lobname; // Use lobid as value
            option.textContent = lob.lobname; // Display lobname
            selectElement.appendChild(option);
        });

    } catch (error) {
        console.error("Error fetching LoB data:", error);

        // Show error message in dropdown
        const selectElement = document.getElementById("interest");
        selectElement.innerHTML = `<option value="">⚠️ Failed to load options</option>`;
    }
}




// Function to close the quotation form
// function closeQuotationForm(event) {
//     event.stopPropagation();
//     const form = document.getElementById("quotation-form");
//     if (form) {
//         form.remove();
//     }

//     // Enable the send button after closing the form
//     document.querySelector(".chat-input button").disabled = false;
// }

// Function to submit the quotation form

async function submitQuotation() {
    const fullName = document.getElementById("fullName").value.trim();
    const email = document.getElementById("email").value.trim();
    const phone = document.getElementById("phone").value.replace(/\D/g, ''); // Remove non-numeric characters
    const interest = document.getElementById("interest").value.trim();

    // Validate fields before submitting
    if (!fullName || !email || !phone || !interest) {
        // displayBotMessage("⚠️ Please fill out all required fields before submitting.");
        showToast("⚠️ Please fill out all required fields before submitting.");
        return;
    }

    const formData = {
        ContactName: fullName,
        Email: email,
        Phone: phone,
        Interest: interest,
        TAGS: interest + "_Others",
        LeadSource: "Website",
        Description: ""
    };

    try {
        const response = await fetch("https://app.bizgaze.com/apis/v4/bizgaze/integrations/leads/chatbot", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer 27f4d43e52654efe8cd3257c36865ac7"
            },
            body: JSON.stringify(formData)
        });

        if (!response.ok) {
            throw new Error("Failed to submit lead. Please try again later.");
        }

        const result = await response.json();

        if (result.status === 2) {
            showToast(`⚠️ ${result.message}`);
            return;
        }

        // ✅ Success: Remove form, reset flag, and show confirmation in chat
        document.querySelector(".form-message").remove();
        isFormOpen = false;
        displayBotMessage("✅ Your request has been submitted! We will get back to you soon.");

    } catch (error) {
        console.error("Error submitting form:", error);
        displayBotMessage("⚠️ Error submitting request. Please try again later.");
    }
}

// ✅ Function to display bot messages in chat
function displayBotMessage(text) {
    const messagesDiv = document.getElementById("chat-messages");
    const botMsg = document.createElement("div");
    botMsg.className = "message bot-message";
    botMsg.innerText = text;
    messagesDiv.appendChild(botMsg);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// Function to append chatbot messages (User/Bot)
function displayBotMessage(text) {
    const messagesDiv = document.getElementById("chat-messages");
    const botMsg = document.createElement("div");
    botMsg.className = "message bot-message";
    botMsg.innerText = text;
    messagesDiv.appendChild(botMsg);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
}



// Close chatbot when clicking outside of it
document.addEventListener("click", function (event) {
    const chatbot = document.getElementById("chatbot");
    const chatbotIcon = document.getElementById("chatbot-icon");

    // If chatbot is open and the click is outside, close it
//     if (chatbot.style.display === "flex" && !chatbot.contains(event.target) && !chatbotIcon.contains(event.target)) {
//         chatbot.style.display = "none";
//         chatbotIcon.style.display = "flex"; 
//     }
});


// Function to handle button clicks for Projects and Products
// function handleButtonClick(message) {
//     sendMessageToBackend(message);
// }

// Function to handle button clicks for predefined queries (About Us, Products, etc.)
function handleButtonClick(messageText) {
    if (isFormOpen) {
        showToast("⚠️ Please complete or close the quotation form before sending a message.");
        return;
    }

    // ✅ Store button-clicked message in chat history
    storeMessage({ type: "user", text: messageText });

    // ✅ Append user message to chat UI
    const messagesDiv = document.getElementById("chat-messages");
    const userMsg = document.createElement("div");
    userMsg.className = "message user-message";
    userMsg.innerHTML = `${messageText}`;
    // messagesDiv.appendChild(userMsg);

    // ✅ Scroll to user's message
    setTimeout(() => {
        userMsg.scrollIntoView({ behavior: "smooth", block: "start" });
    }, 100);

    // ✅ Send message to backend (same as manual input)
    sendMessageToBackend(messageText);
}


async function sendMessageToBackend(messageText) {
    const messagesDiv = document.getElementById("chat-messages");

    // ✅ Append user message
    const userMsg = document.createElement("div");
    userMsg.className = "message user-message";
    userMsg.innerHTML = `${messageText}`;
    messagesDiv.appendChild(userMsg);

    // ✅ Scroll to the user’s message
    setTimeout(() => {
        userMsg.scrollIntoView({ behavior: "smooth", block: "start" });
    }, 100);

    // ✅ Create and append loader
    const loader = document.createElement("div");
    loader.className = "loader";
    messagesDiv.appendChild(loader);
    loader.scrollIntoView({ behavior: "smooth", block: "end" });

    try {
        const response = await fetch("http://192.168.1.155:8000/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: messageText })
        });

        const data = await response.json();
        loader.remove();

        // ✅ Append bot response
        const botMsg = document.createElement("div");
        botMsg.className = "message bot-message";
        botMsg.innerHTML = `${data.response || "I'm here to help!"}`;
        messagesDiv.appendChild(botMsg);

        // ✅ Store bot response in localStorage
        storeMessage({ type: "bot", text: data.response || "I'm here to help!" });

        // ✅ Scroll back to the user's message (NOT to the bottom)
        setTimeout(() => {
            userMsg.scrollIntoView({ behavior: "smooth", block: "start" });
        }, 200);

    } catch (error) {
        console.error("❌ Error fetching response:", error);
        loader.remove();
    }
}


// Append user message to chat UI (for button clicks & manual input)
function appendUserMessage(messageText) {
    const messagesDiv = document.getElementById("chat-messages");
    const userMsg = document.createElement("div");
    userMsg.className = "message user-message";
    userMsg.innerHTML = `${messageText}`;
    messagesDiv.appendChild(userMsg);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
}


// Send message to backend and store response


// Function to open the Quotation Form when "Contact Us" is clicked
function openQuotationForm() {
    showQuotationForm(); // Call the existing function to show the form
}


function closeQuotationForm(event) {
    event.stopPropagation();
    const form = document.getElementById("quotation-form");
    if (form) {
        form.remove();
    }

    // ✅ Reset the flag when the form is closed
    isFormOpen = false;
}




// Generate or retrieve a unique User ID (persistent across reloads)
function getUserId() {
    let userId = localStorage.getItem("userId");
    if (!userId) {
        userId = "user_" + Date.now() + "_" + Math.random().toString(36).substring(2, 10);
        localStorage.setItem("userId", userId);
    }
    return userId;
}

// Store chat messages in localStorage and update timestamp
function storeMessage(message) {
    const userId = getUserId();
    let chatHistory = JSON.parse(localStorage.getItem("chatHistory")) || [];

    // Get current timestamp in **Indian Time (IST) with AM/PM format**
    const timestamp = new Date().toLocaleString("en-IN", { 
        timeZone: "Asia/Kolkata", 
        hour12: true 
    });

    // Attach timestamp to message
    const messageWithTimestamp = { 
        type: message.type, 
        text: message.text, 
        timestamp: timestamp 
    };

    chatHistory.push(messageWithTimestamp);
    localStorage.setItem("chatHistory", JSON.stringify(chatHistory));

    // Update last message time
    localStorage.setItem("lastMessageTime", Date.now());
}


// Load chat history on page refresh
function loadChatHistory() {
    const messagesDiv = document.getElementById("chat-messages");
    const chatHistory = JSON.parse(localStorage.getItem("chatHistory")) || [];

    messagesDiv.innerHTML = ""; // Clear existing messages before loading

    chatHistory.forEach(({ type, text }) => {
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${type}-message`;
        messageDiv.innerHTML = `${text}`;
        messagesDiv.appendChild(messageDiv);
    });

    messagesDiv.scrollTop = messagesDiv.scrollHeight; // Scroll to latest message
}

function showToast(message) {
    const toast = document.getElementById("toast");
    toast.innerText = message;
    toast.classList.add("show");

    setTimeout(() => {
        toast.classList.remove("show");
    }, 3000); // Hide toast after 3 seconds
}


// Check if 10 minutes of inactivity have passed, then send chat history to the database
function checkChatInactivity() {
    const lastMessageTime = localStorage.getItem("lastMessageTime");
    if (!lastMessageTime) return;

    const currentTime = Date.now();
    const timeElapsed = currentTime - parseInt(lastMessageTime);

    if (timeElapsed >= 1 * 60 * 1000) {
        sendChatHistoryToDatabase();
    }
}

function getFormattedISTTimestamp() {
    const now = new Date();
    const options = { timeZone: "Asia/Kolkata", hour12: true, 
                      year: "numeric", month: "2-digit", day: "2-digit", 
                      hour: "2-digit", minute: "2-digit", second: "2-digit" };

    return new Intl.DateTimeFormat("en-IN", options).format(now);
}

// Example usage in sendChatHistoryToDatabase()
async function sendChatHistoryToDatabase() {
    const userId = getUserId();
    const chatHistory = JSON.parse(localStorage.getItem("chatHistory")) || [];
    if (chatHistory.length === 0) return;

    const lastMessageTime = getFormattedISTTimestamp(); // Ensure correct timestamp format

    const dataToSend = {
        userId: userId,
        chatHistory: chatHistory,  // ✅ Ensure this is an array
        lastMessageTime: lastMessageTime // ✅ Ensure this is a string
    };

    console.log("✅ Sending chat history:", JSON.stringify(dataToSend, null, 2));

    try {
        const response = await fetch("http://192.168.1.155:8000/save-chat-history", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(dataToSend)
        });

        if (!response.ok) {
            throw new Error(`❌ Server responded with status: ${response.status}`);
        }

        console.log("✅ Chat history saved successfully!");

        // Clear chat history after successful save
        localStorage.removeItem("chatHistory");
        localStorage.setItem("lastMessageTime", lastMessageTime);

    } catch (error) {
        console.error("❌ Error saving chat history:", error);
        showToast("⚠️ Failed to save chat history. Please try again later.");
    }
}


// Function to send messages and store them properly
// async function sendMessage() {
//     const inputField = document.getElementById("user-input");
//     const messageText = inputField.value.trim();
//     if (!messageText) return;

//     const messagesDiv = document.getElementById("chat-messages");

//     // Append user message
//     const userMsg = document.createElement("div");
//     userMsg.className = "message user-message";
//     userMsg.innerHTML = `${messageText}`;
//     messagesDiv.appendChild(userMsg);

//     // Store in localStorage
//     storeMessage({ type: "user", text: messageText });

//     inputField.value = "";
//     messagesDiv.scrollTop = messagesDiv.scrollHeight;

//     // Create loader
//     const loader = document.createElement("div");
//     loader.className = "loader";
//     messagesDiv.appendChild(loader);
//     loader.scrollIntoView({ behavior: "smooth" });

//     try {
//         const response = await fetch("http://localhost:8000/chat", {
//             method: "POST",
//             headers: { "Content-Type": "application/json" },
//             body: JSON.stringify({ message: messageText })
//         });

//         const data = await response.json();
//         loader.remove();

//         // Append bot response
//         const botMsg = document.createElement("div");
//         botMsg.className = "message bot-message";
//         botMsg.innerHTML = `${data.response || "I'm here to help!"}`;
//         messagesDiv.appendChild(botMsg);

//         // Store bot response in localStorage
//         storeMessage({ type: "bot", text: data.response || "I'm here to help!" });

//         messagesDiv.scrollTop = messagesDiv.scrollHeight;

//     } catch (error) {
//         console.error("Error fetching response:", error);
//         loader.remove();
//     }
// }

// Run inactivity check every 1 minute
setInterval(checkChatInactivity, 60 * 1000);

// Load chat history when the chatbot is opened or refreshed
document.addEventListener("DOMContentLoaded", loadChatHistory);






    </script>
</body>
</html>
